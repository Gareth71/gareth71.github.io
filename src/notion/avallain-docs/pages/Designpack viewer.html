<html>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>Designpack viewer</title>
	<link rel="stylesheet" href="./styles.css">
</head>

<body>
	<article class="page sans">


			<details >
				<summary class="h1">Pre-requirements</summary>

		         <div class="indented">
					<ul>
						<li>
							<p>Avallain Author designpack compiler has been installed on your machine, if not please do so first.</p>
						</li>
					</ul>
				</div>
			</details>	
         


			<details open="">
				<summary class="h1" >Additional set up</summary>

		         <div class="indented">
					<ol>
						<li>
							<p>The viewer looks for files in the wrong locations and needs correcting. Replace the first 3 lines of <code>~/code/avallain/author/viewer/src/index.js</code> with the following</p>
							<pre class="code code-wrap"><code>const url = new URL(window.location)
const locationPath = url.searchParams.get("lo") ? `../lo/${url.searchParams.get("lo")}` : "../lo/example.js"
const designpack = `./dp/${url.searchParams.get("package")}/`;</code></pre>
						</li>
						<li>
							<p>Avallain recommends you add a local server to view yuor LOs, but you can use VS Codes Live Server instead.</p>
							<pre class="code code-wrap"><code>brew install http-server</code></pre>
						</li>
						<li>
							<p>Certain activities like voice recording require certificates, if you want to view them add openssl.</p>
							<pre class="code code-wrap"><code>brew install openssl@1.1</code></pre>
							<p>Then create a certificate in the viewer folder</p>
							<pre class="code code-wrap"><code>cd ~/code/avallain/author/viewer
openssl req -newkey rsa:2048 -new -nodes -x509 -days 3650 -keyout key.pem -out cert.pem</code></pre>
							<p>Fill in the details that it asks for until you get to <code>Common name</code> then add <code>127.0.0.1</code>	
							</code>
	
						</li>
					</ol>
				</div>
			</details>	




		
			<details open="">
				<summary class="h1">Creating a local LO</summary>

		         <div class="indented">


			<p>The data for an LO is stored in a javascript file. Make one for each LO you want to view 
				and populate it with data from an LO you have created in Author.</p>
				<ol type="1" class="numbered-list">
					<li><p>
						Make a file named <code>my-lo-name.js</code> in <code>~/code/avallain/author/viewer/lo/</code>, and populate it with the following.</p>
					</li>
				<pre class="code code-wrap"><code>export default {
  // LOOptions content copied from the LO document head
  options: // window.LOInfo.LOOptions
,
	// replace below with data.do Response
	// replace &quot;=&quot; with &quot;:&quot;  so you have ajaxData: {
	ajaxData: {
	}
}</code></pre>
</p></li>
				
				</li>
					<li><p>
						In Author open the developer tools and in the Network tab add <code>data.do in the search field.</code>.
					</p></li>
					<li><p>
						Preview the LO and select the data.do file in the network tab.
					</p></li>
					<li><p>
						Copy everything in the Response tab and replace <code>ajaxData: {}</code>
						in <code>my-lo-name.js</code> with what you copied.
					</p></li>
					<li><p>
						Replace <code>ajaxData = {</code> with <code>ajaxData: {</code>.
					</p></li>

					<li><p>
						In the console type this <code>window.LOInfo.LOOptions</code>


					</p></li>
					<li><p>
						Copy results and paste after <code>options:</code> in <code>my-lo-name.js</code>
					</p></li>
					<li><p>
						Add an inch mark <code>'</code> at the start and end of what you pasted.
					</p></li>



					</ol>
					</div>
					</details>
					

			<details open="">
				<summary class="h1">Preview an LO</summary>

		         <div class="indented">
						<ol type="1" class="numbered-list">
							<li><p>
								Make sure you have compiled your local design pack.
							</p></li>
							<li><p>
								Point your terminal to the viewer folder, <code>cd ~/code/avallain/author/viewer</code>
							</p></li>
							<li><p>Activate the viewer with <code>npm run start</code></p></li>
							<li><p>Open <a href="http://localhost:8080/?package=child2&amp;lo=my-lo-name.js">localhost:8080/?package=child2&amp;lo=my-lo-name.js</a>, 
								where child2 is the name of the compiled design pack you want to use and my-lo-name.js is the name of the file with your LO data in it.
								</p></li>


						<li><p>Chrome will probably refuse to preview so you can try adding this in a new tab <code>chrome://flags/#allow-insecure-localhost</code>. 
							It didn’t work for me so I also had to go back to the localhost tab and type <strong>thisisunsafe</strong>. You don’t have
							to put your cursor anywhere, as long as the tab is the active one it detects the key presses.</p>
						<li><p>All being well you should see your LO.</p></li>

						<p>If you need to use the Speech tool run this in Chromes console</p>

						<pre class="code code-wrap"><code>const engine = new a5.Engine();
engine.register(&#x27;get-toolbelt-token&#x27;, function() { return $.get(&#x27;https://oup-elt.enterprise.avallainauthor.com/authorj/api/toolbelt/token&#x27;).then(function(response) { return response; });});
engine.initialize();</code></pre>

</li></ol>
					</div>
			</details>

		</div>
</article>

</body>

</html>